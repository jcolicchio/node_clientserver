<html>
	<head>
		<!--<link rel="stylesheet" type="text/css" href="GoBoard.css" />-->
		<script type="text/javascript" src="jquery.min.js"></script>

		<script type="text/javascript" src="Settings.js"></script>


		<script type="text/javascript" src="Input.js"></script>
		<script type="text/javascript" src="Player.js"></script>
		<script type="text/javascript" src="GameState.js"></script>


		<!--<script type="text/javascript" src="NetworkedGoBoard.js"></script>-->
		<script type="text/javascript" src="ServerExchange.js"></script>



		<!-- webgl stuff -->
		<script type="text/javascript" src="webgl_thingy/glMatrix-0.9.5.min.js"></script>
        <script type="text/javascript" src="webgl_thingy/GLModel.js"></script>
        <script type="text/javascript" src="webgl_thingy/GLSphere.js"></script>
        <script type="text/javascript" src="webgl_thingy/GLPyramid.js"></script>
        <script type="text/javascript" src="webgl_thingy/GLCube.js"></script>

		<!--<link rel="stylesheet" type="text/css" href="webgl_thingy/GL.css" />-->
        

        <script id="shader-vs" type="x-shader/x-vertex">
            attribute vec3 aVertexPosition;
            attribute vec3 aVertexNormal;
            attribute vec2 aTextureCoord;
            attribute vec4 aVertexColor;


            uniform mat4 uMVMatrix;
            uniform mat4 uCamMatrix;
            uniform mat4 uPMatrix;
            uniform mat3 uNMatrix; // just inverse of mv transforms
            uniform mat3 uNCamMatrix; // inverse of cam transforms

            uniform bool uUseFlashlight;
            uniform bool uUseLighting;

            varying vec2 vTextureCoord;
            varying vec4 vColor;
            varying vec3 vLightWeighting;


            void main(void) {
                gl_Position = uPMatrix * uCamMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
                vTextureCoord = aTextureCoord;

                //top light
                vec3 topLightDirection = vec3(0, 1, 0);

                //front light
                vec3 camLightDirection = vec3(0, 0, 1);

                //vLightWeighting = vec3(1, 1, 1);
                //vLightWeighting = aVertexPosition;
                vec3 transformedTopNormal = normalize(uNMatrix * aVertexNormal);
                vec3 transformedCamNormal = normalize(uNCamMatrix * uNMatrix * aVertexNormal);
                //vec3 transformedLight = lightDirection;

                float topLightWeighting = max(dot(transformedTopNormal, topLightDirection), 0.0);
                float camLightWeighting = max(dot(transformedCamNormal, camLightDirection), 0.0);

                vLightWeighting = vec3(0.2, 0.2, 0.2) + vec3(0.4, 0.4, 0.4) * topLightWeighting;
                if(uUseFlashlight) {
                    vLightWeighting = vLightWeighting + vec3(0.4, 0.4, 0.4) * camLightWeighting;
                }
                if(!uUseLighting) {
                    vLightWeighting = vec3(1.0, 1.0, 1.0);
                }


                vColor = aVertexColor;
            }
        </script>

        <script id="shader-fs" type="x-shader/x-fragment">
            precision mediump float;

            varying vec2 vTextureCoord;
            varying vec4 vColor;
            varying vec3 vLightWeighting;

            uniform sampler2D uSampler;
            uniform bool uUseTextures;
            uniform float uTextureAlpha;

            void main(void) {
                if(uUseTextures) {
                    vec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
                    
                    //experiment with interpolation
                    //textureColor = vec4(vTextureCoord.s, vTextureCoord.t, 1, 1);
                    
                    gl_FragColor = vec4(textureColor.rgb*vLightWeighting, textureColor.a);//*uTextureAlpha + vColor*(1.0-uTextureAlpha);

                    //vec4 realColor = textureColor*uTextureAlpha + vColor*(1.0-uTextureAlpha);
                    //gl_FragColor = vec4(realColor.rgb*uTextureAlpha, realColor.a);

                } else {
                    gl_FragColor = vec4(vColor.rgb*vLightWeighting, vColor.a);
                }
            }
        </script>

        <script type="text/javascript" src="webgl_thingy/main.js"></script>


		<script type="text/javascript" src="client.js"></script>

	</head>
	<body>
        <input type='submit' value='Enable' id='clientbutton' />
		<canvas id='canvas' width='800' height='500'></canvas>
		<canvas id='2dcanvas' width='400' height='400'></canvas>
	</body>
</html>
